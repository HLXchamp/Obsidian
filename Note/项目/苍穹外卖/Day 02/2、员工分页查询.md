### 需求分析

![[Pasted image 20240515095718.png]]

![[Pasted image 20240515095745.png]]

### 代码开发

![[Pasted image 20240515095914.png]]

![[Pasted image 20240515095933.png|500]]

Controller：

```java
@GetMapping("/page")  
@ApiOperation(("员工分页查询"))  
public Result<PageResult> page(EmployeePageQueryDTO employeePageQueryDTO) { //数据格式不是json，不用加@RequestBody  
    log.info("员工分页查询，参数为{}", employeePageQueryDTO);  
    PageResult pageResult = employeeService.pageQuery(employeePageQueryDTO);  
    return Result.success(pageResult); // success里面传的是data中的值  
}
```

Service层用PageHelper简化查询操作，它底层也是基于ThreadLocal：

```java
PageResult pageQuery(EmployeePageQueryDTO employeePageQueryDTO);
```

```java
@Override  
public PageResult pageQuery(EmployeePageQueryDTO employeePageQueryDTO) {  
    //用PageHelper简化查询操作，它底层也是基于ThreadLocal  
    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());  
    Page<Employee> page = employeeMapper.pageQuery(employeePageQueryDTO);  
  
    Long total = page.getTotal();  
    List<Employee> employees = page.getResult();  
    return new PageResult(total, employees);  
}
```

Mapper，有了之前的PageHelper，就不用自己写limit查询了：


```java
/**  
 * 根据用户名查询员工  
 * @param employeePageQueryDTO  
 * @return  
 */  
Page<Employee> pageQuery(EmployeePageQueryDTO employeePageQueryDTO);
```

```xml
<mapper namespace="com.sky.mapper.EmployeeMapper">  
    <select id="pageQuery" resultType="com.sky.entity.Employee">  
        select * from employee  
        <where>  
            <if test="name != null and name != ''">  
                and name like concat('%',#{name},'%')  
            </if>  
        </where>  
        order by create_time desc  
    </select>  
</mapper>
```

### 功能测试

日期格式有问题：

![[Pasted image 20240515102359.png]]

![[Pasted image 20240515102439.png]]

### 代码完善

解决日期显示问题：

![[Pasted image 20240515102523.png]]

建议使用方法二，因为以后也可能用LocalTime，方法一每次用都要加注解。

config中的WebMvcConfiguration类：

```java
/**  
 * 扩展Spring MVC的消息转换器  
 * @param converters  
 */  
//不要加@OverRide  
protected void extendMessageConverters(List<HttpMessageConverter<?>> converters) {  
    log.info("扩展消息转换器...");  
    //创建一个消息转换器对象  
    MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();  
    //需要为消息转换器设置一个对象转换器，对象转换器可以将java对象序列化为Json数据  
    converter.setObjectMapper(new JacksonObjectMapper());  
    //将自己的消息转换器加入到容器中  
    converters.add(0,converter);  
}
```

修改成功：

![[Pasted image 20240515103446.png]]