### 需求分析与设计

![[Pasted image 20240516123954.png]]

![[Pasted image 20240516124011.png|500]]

![[Pasted image 20240516124042.png]]

### 代码开发

![[Pasted image 20240516124407.png]]

![[Pasted image 20240516124434.png]]

DishController：

```java
@GetMapping("/page")  
@ApiOperation("菜品分页查询")  
public Result<PageResult> page(DishPageQueryDTO dishPageQueryDTO){ //这里前端传的不是json，就不用@@RequestBody  
    log.info("菜品分页查询：{}",dishPageQueryDTO);  
    PageResult pageResult = dishService.pageQuary(dishPageQueryDTO);  
    return Result.success(pageResult);  
}
```

- DTO 可以是前端给后端的数据，也可以是后端给前端的数据。
- VO 通常是后端给前端的数据，用于前端显示。

所以将dishPageQueryDTO传给Service层，Service层将dishPageQueryDTO封装成DishVO再返回给Controller，再返回给前端。

Service：

```java
/**  
 * 分页查询  
 * @param dishPageQueryDTO  
 * @return  
 */  
PageResult pageQuary(DishPageQueryDTO dishPageQueryDTO);
```

```java
@Override  
public PageResult pageQuary(DishPageQueryDTO dishPageQueryDTO) {  
    PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());  
    Page<DishVO> page = dishMapper.pageQuery(dishPageQueryDTO);  
    return new PageResult(page.getTotal(), page.getResult());  
}
```

Mapper：

```java
/**  
 * 分页查询  
 * @param dishPageQueryDTO  
 * @return  
 */  
Page<DishVO> pageQuery(DishPageQueryDTO dishPageQueryDTO);
```

```xml
<select id="pageQuery" resultType="com.sky.vo.DishVO">  
    select d.*, c.name as categoryName from dish d left outer join category c on d.category_id = c.id  
    <where>  
        <if test="name != null and name != '' ">  
            and d.name like concat('%',#{name},'%')  
        </if>  
        <if test="categoryId != null">  
            and d.category_id = #{categoryId}  
        </if>  
        <if test="status != null">  
            and d.status = #{status}  
        </if>  
    </where>   
</select>
```

难点：
- DTO与VO转换
- 关联表的查询：`left outer join`

### 测试

测试没问题，但这里的图片没有显示是因为数据库中的阿里OSS是北京端点，我们自己使用的是杭州的，没法访问。

![[Pasted image 20240516133317.png]]

