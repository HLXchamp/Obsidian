### 需求分析与设计

![[Pasted image 20240516162617.png]]

![[Pasted image 20240516162724.png]]

![[Pasted image 20240516162758.png]]

### 代码开发

#### 根据ID查询菜品

Controller：

```java
@GetMapping("/{id}")  
@ApiOperation("根据ID查询菜品")  
public Result<DishVO> getById(@PathVariable Long id) {  
    log.info("根据ID查询菜品：{}",id);  
    DishVO dishVO = dishService.getByIdWithFlavor(id);  
    return Result.success(dishVO);  
}
```

Service：

```java
/**  
 * 根据id查询菜品  
 * @param id  
 * @return  
 */  
DishVO getByIdWithFlavor(Long id);
```

```java
@Override  
public DishVO getByIdWithFlavor(Long id) {  
    //根据ID查询菜品数据  
    Dish dish = dishMapper.getById(id);  
  
    //根据菜品ID查询口味数据  
    List<DishFlavor> dishFlavors = dishFlavorMapper.getByDishId(id);  
  
    //将查询到的数据封装到VO  
    DishVO dishVO = new DishVO();  
    BeanUtils.copyProperties(dish, dishVO);  
    dishVO.setFlavors(dishFlavors);  
  
    return dishVO;  
}
```

DishFlavorMapper：

```java
@Select("select * from dish_flavor where dish_id = #{dishId}")  
List<DishFlavor> getByDishId(Long dishId);
```

DishMapper里的getById查询在[[4、删除菜品#代码开发]]里写过了，直接调用就行。

#### 修改菜品

Controller：

```java
@PutMapping  
@ApiOperation("修改菜品")  
public Result update(@RequestBody DishDTO dishDTO) {  
    log.info("修改菜品：{}",dishDTO);  
    dishService.updateWithFlavor(dishDTO);  
    return Result.success();  
}
```

Service：

```java
/**  
 * 修改对应菜品和口味信息  
 * @param dishDTO  
 */  
void updateWithFlavor(DishDTO dishDTO);
```

```java
@Override  
@Transactional  
public void updateWithFlavor(DishDTO dishDTO) {  
    //修改菜品基本信息  
    Dish dish = new Dish();  
    BeanUtils.copyProperties(dishDTO, dish);  
    dishMapper.update(dish);  
  
    //删除原有的口味数据  
    dishFlavorMapper.deleteByDishId(dishDTO.getId());  
  
    //重新插入口味数据  
    List<DishFlavor> flavors = dishDTO.getFlavors();  
    if(flavors != null && !flavors.isEmpty()) {  
        flavors.forEach(dishFlavor -> {  
            dishFlavor.setDishId(dish.getId());  
        });  
        //批量插入  
        dishFlavorMapper.insertBatch(flavors);  
    }  
}
```

DishMapper：

```java
/**  
 * 修改菜品信息  
 * @param dish  
 */  
@AutoFill(value = OperationType.UPDATE)  
void update(Dish dish);
```

```xml
<update id="update">  
    update dish  
    <set>  
        <if test="name != null and name != ''">  
            name = #{name},  
        </if>  
        <if test="categoryId != null">category_id = #{categoryId},</if>  
        <if test="price != null">price = #{price},</if>  
        <if test="image != null">image = #{image},</if>  
        <if test="description != null">description = #{description},</if>  
        <if test="status != null">status = #{status},</if>  
        <if test="updateTime != null">update_time = #{updateTime},</if>  
        <if test="updateUser != null">update_user = #{updateUser},</if>  
    </set>  
    where id = #{id}  
</update>
```

dishFlavorMapper里的方法都是之前实现了的，直接调用即可。

### 测试

查询没问题：

![[Pasted image 20240516171111.png]]

修改没问题：

![[Pasted image 20240516171149.png]]