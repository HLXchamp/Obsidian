###  需求分析和设计

产品原型：

![image-20221018153756531](assets/image-20221018153756531.png)

业务规则：

- 可以一次删除一个套餐，也可以批量删除套餐
- 起售中的套餐不能删除

接口设计：

![image-20221018154541067|500](assets/image-20221018154541067.png)


### 代码开发

##### 错误点：

- 还要删除套餐-菜品关系表中的数据（不会真正删除菜品数据）！

![[Pasted image 20240517101641.png|500]]

- 判断起售状态时要在Mapper新建一个根据ID查询的方法，来查对应的状态。

##### 关键代码：

SetmealService：

```java
@Override  
@Transactional  
public void deleteBatch(List<Long> ids) {  
    //起售中的套餐不能删除  
    for (Long id : ids) {  
        if(Objects.equals(setmealMapper.getById(id).getStatus(), StatusConstant.ENABLE)){  
            throw new DeletionNotAllowedException(MessageConstant.SETMEAL_ON_SALE);  
        }  
    }  
    //批量删除套餐  
    setmealMapper.deleteByIds(ids);  
    //批量删除套餐-菜品关系表中的数据  
    setmealDishMapper.deleteBySetmealIds(ids);  
}
```

Mapper中的两个删除都是批量删除，用foreach：

```xml
<delete id="deleteByIds">  
    delete from setmeal where id in  
    <foreach collection="ids" item="id" separator="," open="(" close=")">  
        #{id}  
    </foreach>  
</delete>
```

### 测试

没问题~

![[Pasted image 20240517103236.png]]

![[Pasted image 20240517103250.png]]



