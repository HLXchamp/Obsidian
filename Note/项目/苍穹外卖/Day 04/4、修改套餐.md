### 需求分析和设计

产品原型：

![image-20221018160214225|650](assets/image-20221018160214225.png)

接口设计（共涉及到5个接口）：

- 根据id查询套餐
- 根据类型查询分类（已完成）
- 根据分类id查询菜品（已完成）
- 图片上传（已完成）
- 修改套餐

![image-20221018160915177|425](assets/image-20221018160915177.png)

![image-20221018160949864|475](assets/image-20221018160949864.png)

![image-20221018161046352|450](assets/image-20221018161046352.png)

![image-20221018161117780|500](assets/image-20221018161117780.png)

![image-20221018161139861|500](assets/image-20221018161139861.png)

### 代码开发

##### 错误点：

- 要设计两个Controller接口，且getById返回值是SetmealVO类型，返回给前端展示！

```java
public Result<SetmealVO> getById(@PathVariable Long id)
```

- 修改逻辑最初没搞懂，套餐就该怎么改怎么改，关联的菜品可以先删除，再批量新增选中的。

##### 重要代码：

SetmealSeviceImpl（要注意各个方法的返回值！）：

```java
@Override  
public SetmealVO getWithDish(Long id) {  
    //获取套餐信息  
    Setmeal setmeal = setmealMapper.getById(id);  
    SetmealVO setmealVO = new SetmealVO();  
    //封装到setmealVO  
    BeanUtils.copyProperties(setmeal, setmealVO);  
    //获取套餐关联的菜品信息  
    List<SetmealDish> list = setmealDishMapper.getDishBySetmealId(id);  
    //封装到setmealVO  
    setmealVO.setSetmealDishes(list);  
    return setmealVO;  
}
```

```java
@Override  
public void updateWithDish(SetmealDTO setmealDTO) {  
    //先更新套餐信息  
    Setmeal setmeal = new Setmeal();  
    BeanUtils.copyProperties(setmealDTO, setmeal);  
    setmealMapper.update(setmeal);  
  
    //先删除对应菜品  
    setmealDishMapper.deleteBySetmealId(setmealDTO.getId());  
  
    //再获取DTO传来的菜品，新增对应菜品  
    List<SetmealDish> setmealDishes = setmealDTO.getSetmealDishes();  
    if (setmealDishes != null && !setmealDishes.isEmpty()) {  
        for (SetmealDish setmealDish : setmealDishes) {  
            //要给每条菜品都加上套餐的ID，这样才能标识到一起  
            setmealDish.setSetmealId(setmealDTO.getId());  
        }  
        //批量插入  
        setmealDishMapper.insertBatch(setmealDishes);  
    }
}
```

### 测试

根据ID查询没问题：

![[Pasted image 20240517110821.png]]

修改成功：

![[Pasted image 20240517113023.png]]

有点小问题：点击添加菜品后无论之前份数是多少都会变成1。

![[Pasted image 20240517113010.png]]