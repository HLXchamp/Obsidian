
![[Pasted image 20240508204930.png]]

![[Pasted image 20240508205009.png]]

controller：

```java
@Slf4j  
@RestController  
public class EmpController {  
  
    @Autowired  
    private EmpService empService;  
  
    @GetMapping("/emps")  
    public Result page(@RequestParam(defaultValue = "1") Integer page,  
                       @RequestParam(defaultValue = "10") Integer pageSize,  
                       String name, Short gender,  
                       @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,  
                       @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end) {  
        log.info("分页查询, 参数: {},{},{},{},{},{}", page, pageSize, name, gender, begin, end);  
        //调用service分页查询  
        PageBean pageBean = empService.page(page, pageSize, name, gender, begin, end);  
  
        return Result.success(pageBean);  
    }  
}
```

EmpService：

```java
public interface EmpService {  
  
    PageBean page(Integer page, Integer pageSize, String name, Short gender, LocalDate begin, LocalDate end);  
}
```

EmpServiceImpl：

```java
@Service  
public class EmpServiceImpl implements EmpService {  
  
    @Autowired  
    private EmpMapper empMapper;  
  
    @Override  
    public PageBean page(Integer page, Integer pageSize, String name, Short gender, LocalDate begin, LocalDate end) {  
  
        //1. 设置分页参数  
        PageHelper.startPage(page, pageSize);  
  
        //2。执行查询  
        List<Emp> empList = empMapper.list(name, gender, begin, end);  
        Page<Emp> p = (Page<Emp>) empList;  
  
        //3. 封装PageBean对象  
        PageBean pageBean = new PageBean(p.getTotal(), p.getResult());  
        return pageBean;  
    }  
}
```

EmpMapper：

```java
@Mapper  
public interface EmpMapper {  

    //用pagehelper简化查询  
//    @Select("select * from emp")  
    List<Emp> list(String name, Short gender, LocalDate begin, LocalDate end) ;  
}
```

XML映射文件：

```xml
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper  
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
  
<mapper namespace="org.example.mapper.EmpMapper">  
    <!-- 条件查询 -->  
    <select id="list" resultType="org.example.pojo.Emp">  
        select * from emp  
        <where>  
            <if test="name != null and name != ''">name like concat('%',#{name},'%')</if>  
            <if test="gender != null">and gender = #{gender}</if>  
            <if test="begin != null and end != null">and entrydate between #{begin} and #{end}</if>  
        </where>  
        order by update_time desc  
    </select>  
</mapper>
```

注：`<if test="name != null and name != ''">`要考虑两种情况！

查询成功：

![[Pasted image 20240508205201.png]]