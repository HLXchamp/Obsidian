### 自动配置概念

![[Pasted image 20240513091938.png]]

例：

![[Pasted image 20240513092035.png]]

### 自动配置方案

![[Pasted image 20240513093748.png]]

![[Pasted image 20240513093832.png]]

HeaderConfig配置类：

```java
package com.example;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class HeaderConfig {

    @Bean
    public HeaderParser headerParser(){
        return new HeaderParser();
    }

    @Bean
    public HeaderGenerator headerGenerator(){
        return new HeaderGenerator();
    }
}
```

MyImportSelector实现类（实现了ImportSelector方法，里面字符串就是要导入进IOC容器的类）：

```java
package com.example;

import org.springframework.context.annotation.ImportSelector;
import org.springframework.core.type.AnnotationMetadata;

public class MyImportSelector implements ImportSelector {
    public String[] selectImports(AnnotationMetadata importingClassMetadata) {
        return new String[]{"com.example.HeaderConfig"};
    }
}

```

EnableHeaderConfig注解，导入了MyImportSelector实现类，在想导入的类上直接加上这个注解就行：

```java
package com.example;

import org.springframework.context.annotation.Import;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Import(MyImportSelector.class)
public @interface EnableHeaderConfig {
}
```

![[Pasted image 20240513094328.png|575]]

### 源码跟踪

![[Pasted image 20240513094817.png]]

![[Pasted image 20240513100643.png]]

不是全部都会注入，会根据@Conditional注解按照条件加入。

注：3.0.0后的版本可能有差异，上图是2.7版本的代码。

### @Conditional

![[Pasted image 20240513100011.png]]

![[Pasted image 20240513100428.png]]

@ConditionalOnMissionBean常常用在默认配置类上，如果你新定义了配置类就用你的，否则用默认的。

例：

![[Pasted image 20240513100710.png|375]]

### 案例-自定义starter

![[Pasted image 20240513101101.png]]

![[Pasted image 20240513101252.png]]



