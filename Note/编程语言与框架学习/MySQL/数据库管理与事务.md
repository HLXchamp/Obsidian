## 1.1 数据库管理概述

一、什么是数据库管理
数据库管理是指为保证数据库系统的**正常运行**和**服务质量**必须进行的系统管理工作。

二、DBMS管理功能结构

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210414151009936.png =450x360)

三、DBMS系统层次结构

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210414151141730.png =500x520)

## 1.2 事务管理

一、为什么需要事务管理
在业务处理的每个操作步骤中，都可能遭遇失败，若没有一个处理机制，就可能造成操作**数据混乱**，从而**破坏数据一致性**。

二、**事务概念**
在数据库中，**事务**是指由构成**单个业务处理单元**的一组数据库访问操作，要求它们**要么都成功执行，要么都不执行**。

三、**事务状态**
在数据库系统中，事务是DBMS执行的**最小任务单元**。
事务也是DBMS**最小**的**故障恢复任务单元**和**并发控制任务单元**。其生命周期状态变迁如图所示。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210414152402546.png =700x)

四、**事务四大特性**

**ACID**特性：
**原子性**：事务所有操作在数据库中要么全部执行，要么全部不执行。
**一致性**：事务多次执行，其结果应一致。
**隔离性**：事务与事务之间隔离，并发执行透明。
**持续性**：事务完成后，数据**改变必须是永久的**。

五、**事务并发执行**
事务并发执行是指**多个事务**程序在数据库系统中**同一时段**运行。

并发执行原因：

 1. 改善系统的**资源利用率**
 2. **减少**事务运行的**平均等待时间**

六、**事务SQL程序**

1.**事务SQL语句**
**BEGIN**  或 **START TRANSACTION**	；事务**开始**语句
**ROLLBACK**					                        ；事务**回滚**语句
**COMMIT**					                            ；事务**提交**语句		
**SAVEPOINT**			                        	；事务**保存点**语句

2.事务SQL程序**基本框架**

![在这里插入图片描述|600](https://img-blog.csdnimg.cn/20210414153143901.png)

3.事务程序中不能使用的SQL语句

![在这里插入图片描述|350](https://img-blog.csdnimg.cn/20210414153242950.png)

七、DBMS默认事务方式
若用户没有显式地定义事务时，DBMS按默认事务方式处理，即每执行一个SQL语句将自动构成一个事务。

## 1.3 并发控制

### 1.3.1 事务调度

一、为什么需要并发控制

 - 支持并发事务处理，使更多用户并行操作，提高系统的并发访问能力。
 - 保证一个事务工作不会对另一个事务工作产生不合理的影响。

二、并发控制需解决的问题

**1.丢失更新数据**

![在这里插入图片描述|425](https://img-blog.csdnimg.cn/20210414155943482.png)

当事务T1和T2均读入该共享数据A并修改，T2提交的结果破坏了T1提交的结果，导致T1的修改被丢失。

**2.不可重复读取**
指一个事务对一个共享数据**重复多次读取**，但**前后读取的数据不一致**。

![在这里插入图片描述|317](https://img-blog.csdnimg.cn/20210414160207717.png)

出现这种问题的原因：多个事务并发运行时，一些事务对共享数据进行多次读操作，但其中一个事务对共享数据进行了**修改或删除**操作。

**3.幻象读取**
幻像读指一个事务对同一共享数据重复读取两次，但是发现第2次读取比第1次读取的结果中**新增**
了一些数据。
出现这种问题的原因：多个事务并发运行，其中一个事务同时在对共享数据进行**添加操作**。

**4.脏数据读取**
脏数据读取是指一个事务读取了被**取消持久化**的共享数据。

![在这里插入图片描述|550](https://img-blog.csdnimg.cn/20210414162745713.png)

三、**并发事务调度原理与策略**

**并发事务调度**就是控制多个事务的数据操作语句按照恰当的顺序访问共享数据，使这些事务执行之后，**避免造成数据的不一致性**，即解决“丢失更新数据”、“不可重复读”、“脏数据读”等问题。

1.**事务调度原理**

![在这里插入图片描述|332](https://img-blog.csdnimg.cn/2021041420441346.png)

2.**事务调度策略**

在事务并发执行中，只有当事务中数据操作调度顺序的执行结果与事务**串行执行结果**一样时，该并发事务调度才能保证数据操作的正确性和一致性。符合这样效果的调度称为可串行化调度。

DBMS并发事务调度**目标**：使并发事务调度实现的处理结果与**串行化调度处理结果一致**。

### 1.3.2 锁机制、控制协议、死锁、事务隔离

一、**数据库锁机制**
为了解决多个事务并发对共享数据进行新增、更新、删除、查询带来的数据不一致性问题时，需要对共享数据进行**加锁访问**。
